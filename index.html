<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hokejový Simulátor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 2rem;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, button, textarea {
      padding: 0.5rem;
      margin: 0.5rem 0;
      width: 100%;
      font-size: 1rem;
    }
    .result {
      margin-top: 2rem;
      background: #e8f4ff;
      padding: 1rem;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Hokejový Simulátor</h1>
    <input type="text" id="teamA" placeholder="Název týmu A" />
    <input type="number" id="ratingA" placeholder="Rating týmu A (0-100)" />
    <textarea id="rosterA" rows="5" placeholder="Soupiska týmu A - každý hráč na nový řádek (12 útočníků, 8 obránců, 1 brankář)"></textarea>
    <input type="text" id="teamB" placeholder="Název týmu B" />
    <input type="number" id="ratingB" placeholder="Rating týmu B (0-100)" />
    <textarea id="rosterB" rows="5" placeholder="Soupiska týmu B - každý hráč na nový řádek (12 útočníků, 8 obránců, 1 brankář)"></textarea>
    <button onclick="simulateMatch()">Simulovat zápas</button>
    <div class="result" id="result"></div>
  </div>
  <script>
function simulateShootout(forwardsA, defendersA, forwardsB, defendersB) {
  const scorersA = [];
  const scorersB = [];
  const getShooter = (forwards, defenders) => {
    return Math.random() < 0.95
      ? forwards[Math.floor(Math.random() * forwards.length)]
      : defenders[Math.floor(Math.random() * defenders.length)];
  };

  let goalsA = 0, goalsB = 0;
  let minute = 66;

  for (let i = 0; i < 5; i++) {
    const shooterA = getShooter(forwardsA, defendersA);
    const shooterB = getShooter(forwardsB, defendersB);

    if (Math.random() < 0.45) {
      scorersA.push({ name: shooterA, assists: [], minute });
      goalsA++;
    }
    if (Math.random() < 0.45) {
      scorersB.push({ name: shooterB, assists: [], minute });
      goalsB++;
    }
    minute++;
  }

  let winner = null;
  while (goalsA === goalsB) {
    const shooterA = getShooter(forwardsA, defendersA);
    const shooterB = getShooter(forwardsB, defendersB);

    const scoreA = Math.random() < 0.45;
    const scoreB = Math.random() < 0.45;

    if (scoreA) {
      scorersA.push({ name: shooterA, assists: [], minute });
      goalsA++;
    }
    if (scoreB) {
      scorersB.push({ name: shooterB, assists: [], minute });
      goalsB++;
    }

    if (scoreA !== scoreB) {
      winner = scoreA ? 'A' : 'B';
      break;
    }
    minute++;
  }

  return { scorersA, scorersB, winner };
}

function simulateMatch() {
  const teamA = document.getElementById("teamA").value;
  const teamB = document.getElementById("teamB").value;
  const ratingA = parseInt(document.getElementById("ratingA").value);
  const ratingB = parseInt(document.getElementById("ratingB").value);
  const rosterA = document.getElementById("rosterA").value.trim().split("\n");
  const rosterB = document.getElementById("rosterB").value.trim().split("\n");

  const forwardsA = rosterA.slice(0, 12);
  const defendersA = rosterA.slice(12, 20);
  const goalieA = rosterA[20];

  const forwardsB = rosterB.slice(0, 12);
  const defendersB = rosterB.slice(12, 20);
  const goalieB = rosterB[20];

  const shotsA = Math.floor(Math.random() * 20 + 20 + (ratingA - ratingB) / 2);
  const shotsB = Math.floor(Math.random() * 20 + 20 + (ratingB - ratingA) / 2);

  const savePercentA = 0.85 + Math.random() * 0.1;
  const savePercentB = 0.85 + Math.random() * 0.1;

  let goalsA = Math.max(0, Math.floor(shotsA * (1 - savePercentB)));
  let goalsB = Math.max(0, Math.floor(shotsB * (1 - savePercentA)));

  let scorersA = [], scorersB = [];
  for (let i = 0; i < goalsA; i++) {
    const minute = Math.floor(Math.random() * 60);
    const scorer = forwardsA[Math.floor(Math.random() * forwardsA.length)];
    const assist1 = Math.random() < 0.7 ? forwardsA[Math.floor(Math.random() * forwardsA.length)] : null;
    const assist2 = assist1 && Math.random() < 0.5 ? forwardsA[Math.floor(Math.random() * forwardsA.length)] : null;
    scorersA.push({ name: scorer, assists: [assist1, assist2].filter(Boolean), minute });
  }
  for (let i = 0; i < goalsB; i++) {
    const minute = Math.floor(Math.random() * 60);
    const scorer = forwardsB[Math.floor(Math.random() * forwardsB.length)];
    const assist1 = Math.random() < 0.7 ? forwardsB[Math.floor(Math.random() * forwardsB.length)] : null;
    const assist2 = assist1 && Math.random() < 0.5 ? forwardsB[Math.floor(Math.random() * forwardsB.length)] : null;
    scorersB.push({ name: scorer, assists: [assist1, assist2].filter(Boolean), minute });
  }

  let resultText = `<strong>${teamA} ${goalsA} : ${goalsB} ${teamB}</strong><br/>`;
  let overtime = false;
  let shootout = false;
  let shootoutResult = null;

  if (goalsA === goalsB) {
    overtime = true;
    if (Math.random() < 0.5) {
      const minute = Math.floor(Math.random() * 5) + 61;
      const isA = Math.random() < 0.5;
      const scorer = isA ? forwardsA[Math.floor(Math.random() * forwardsA.length)] : forwardsB[Math.floor(Math.random() * forwardsB.length)];
      const assist1 = Math.random() < 0.7 ? (isA ? forwardsA : forwardsB)[Math.floor(Math.random() * 12)] : null;
      const assist2 = assist1 && Math.random() < 0.5 ? (isA ? forwardsA : forwardsB)[Math.floor(Math.random() * 12)] : null;
      if (isA) { goalsA++; scorersA.push({ name: scorer, assists: [assist1, assist2].filter(Boolean), minute }); }
      else { goalsB++; scorersB.push({ name: scorer, assists: [assist1, assist2].filter(Boolean), minute }); }
      resultText = `<strong>${teamA} ${goalsA} : ${goalsB} ${teamB} pp</strong><br/>`;
    } else {
      shootout = true;
      shootoutResult = simulateShootout(forwardsA, defendersA, forwardsB, defendersB);
      if (shootoutResult.winner === 'A') goalsA++;
      if (shootoutResult.winner === 'B') goalsB++;
      scorersA.push(...shootoutResult.scorersA);
      scorersB.push(...shootoutResult.scorersB);
      resultText = `<strong>${teamA} ${goalsA} : ${goalsB} ${teamB} sn</strong><br/>`;
    }
  }

  resultText += `Střely: ${shotsA} : ${shotsB}<br/>Zákroky: ${shotsB - goalsB} : ${shotsA - goalsA}<br/><br/>`;

  resultText += `<u>Střelci ${teamA}:</u><br/>`;
  scorersA.forEach(s => {
    resultText += `${s.minute}'. ${s.name}`;
    if (s.assists.length > 0) resultText += ` (Asistence: ${s.assists.join(", ")})`;
    resultText += `<br/>`;
  });
  resultText += `<br/><u>Střelci ${teamB}:</u><br/>`;
  scorersB.forEach(s => {
    resultText += `${s.minute}'. ${s.name}`;
    if (s.assists.length > 0) resultText += ` (Asistence: ${s.assists.join(", ")})`;
    resultText += `<br/>`;
  });

  document.getElementById("result").innerHTML = resultText;
}
  </script>
</body>
</html>
